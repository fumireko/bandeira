
<ul class="nav nav-tabs me-auto mb-2 mb-lg-0 mt-0 pt-0 bg-custom">
    <li class="nav-item">
        <a class="nav-link mt-1 mx-1 " [routerLink]="['/pedidos']">Pedidos</a>
    </li>
    <li class="nav-item">
        <a class="nav-link mt-1 mx-1 " [routerLink]="['/produtos']">Produtos</a>
    </li>
    <li class="nav-item">
        <a class="nav-link mt-1 mx-1 " [routerLink]="['/categorias']">Categorias</a>
    </li>
    <li class="nav-item">
        <a class="nav-link active mt-1 mx-1 " [routerLink]="['/encartes/produtos']">Encartes</a>
    </li>
</ul>    

<body>
    <div class="row mx-auto justify-content-between" style="width: 70vw;">
        <h1 class="fw-semibold mx-0 mt-3 p-0 col-9">
            Produtos para Encarte
        </h1>    
        <button class="btn btn-success mt-4 col-3 h-25 my-auto" [disabled]="selecionados.length === 0" (click)="gerarEncarte()">
            <i class="fa-solid fa-layer-group"></i>
            Gerar encarte
        </button>
    </div>

    <div class="row mx-auto" style="width: 70vw;">
        <div class="mb-3" style="width: 35vw;">
            <div class="row">
                <div class="form-check m-0 pt-3 col-6">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="mostrarImagens">
                    <label class="form-check-label">Exibir Imagens</label>
                </div>
    
                <div class="form-check m-0 pt-3 col-6">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="mostrarIndisponiveis" (change)="atualizarListagem()">
                    <label class="form-check-label">Mostrar indisponíveis</label>
                </div>
            </div>
        </div>
    
        <div class="mb-3 input-group" style="width: 35vw;">
            <input type="text" class="form-control mt-2" style="width: 67%" placeholder="Buscar produtos"
            [(ngModel)]="termoBusca" (input)="filtrarProdutos()">
            <select class="form-select mt-2" id="categoria" name="categoria" style="width: 33%" [(ngModel)]="categoriaDescricao" (change)="filtrarProdutos()">
                <option value="">Todas as categorias</option>
                <option *ngFor="let categoria of categorias" [value]="categoria.descricao">{{categoria.descricao}}</option>
            </select>              
        </div>
    </div>

    <table class="table table-bordered table-hover mx-auto" style="width: 70vw;">
        <tbody>
            <tr class="text-center">
                <th>Seleção</th>
                <th (click)="alternarOrdem('id')">
                    Código
                    <i class="fas fa-sort" *ngIf="colunaOrdenacao !== 'id'"></i>
                    <i class="fas fa-sort-up" *ngIf="colunaOrdenacao === 'id' && ordemAscendente"></i>
                    <i class="fas fa-sort-down" *ngIf="colunaOrdenacao === 'id' && !ordemAscendente"></i>
                </th>
                <th *ngIf="mostrarImagens" (click)="alternarOrdem('imagem')">
                    Imagem
                    <i class="fas fa-sort" *ngIf="colunaOrdenacao !== 'imagem'"></i>
                    <i class="fas fa-sort-up" *ngIf="colunaOrdenacao === 'imagem' && ordemAscendente"></i>
                    <i class="fas fa-sort-down" *ngIf="colunaOrdenacao === 'imagem' && !ordemAscendente"></i>
                </th>
                <th (click)="alternarOrdem('nome')">
                    Descrição
                    <i class="fas fa-sort" *ngIf="colunaOrdenacao !== 'nome'"></i>
                    <i class="fas fa-sort-up" *ngIf="colunaOrdenacao === 'nome' && ordemAscendente"></i>
                    <i class="fas fa-sort-down" *ngIf="colunaOrdenacao === 'nome' && !ordemAscendente"></i>
                </th>
                <th (click)="alternarOrdem('preco')">
                    Preço
                    <i class="fas fa-sort" *ngIf="colunaOrdenacao !== 'preco'"></i>
                    <i class="fas fa-sort-up" *ngIf="colunaOrdenacao === 'preco' && ordemAscendente"></i>
                    <i class="fas fa-sort-down" *ngIf="colunaOrdenacao === 'preco' && !ordemAscendente"></i>
                </th>
                <th (click)="alternarOrdem('disponivel')">
                    Status
                    <i class="fas fa-sort" *ngIf="colunaOrdenacao !== 'disponivel'"></i>
                    <i class="fas fa-sort-up" *ngIf="colunaOrdenacao === 'disponivel' && ordemAscendente"></i>
                    <i class="fas fa-sort-down" *ngIf="colunaOrdenacao === 'disponivel' && !ordemAscendente"></i>
                </th>
            </tr>
            <tr *ngFor="let produto of filtrados" class="text-center">
              <td>
                <input type="checkbox" [checked]="isSelected(produto)" (change)="toggleSelection(produto)">
              </td>
              <td>{{produto.id}}</td>
              <td *ngIf="mostrarImagens">
                <span class="text-danger fw-bold"><img *ngIf="produto.imagem" [src]="produto.imagem" alt="Imagem inválida" class="img-fluid w-50" loading="lazy"></span>
              </td>              
              <td class="text-start">{{produto.nome}}</td>
              <td>R{{produto.preco | currency }}</td>  
              <td [ngClass]="{'text-success': produto.disponivel, 'text-danger': !produto.disponivel}">
                {{ produto.disponivel ? 'OK' : 'Indisponível' }}
              </td>
            </tr>
        </tbody>
    </table>
    <p *ngIf="produtos.length==0" class="text-center">Nenhum produto cadastrado.</p>
</body>